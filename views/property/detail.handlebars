<link rel="stylesheet" href="/css/reviews.css">

<h1>{{bnb.title}}</h1>
<p><strong>City:</strong> {{bnb.city}}</p>
<p><strong>Address:</strong> {{bnb.address}}</p>
<p><strong>Price per night:</strong> ${{bnb.pricePerNight}}</p>
<p><strong>Bedrooms:</strong> {{bnb.bedrooms}}</p>
<p><strong>Bathrooms:</strong> {{bnb.bathrooms}}</p>
<p><strong>Amenities:</strong> {{#each bnb.amenities}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}</p>
<p><strong>Average Rating:</strong> {{bnb.averageRating}}</p>

<h2>Description</h2>
<p>{{bnb.description}}</p>

<hr>

<h2>Reviews</h2>
{{#if reviews.length}}
<ul class="reviews-list">
  {{#each reviews}}
  <li class="review-item">
    <strong>{{this.author}}</strong>: {{this.comment}} (Rating: {{this.rating}})
    <br>
    <button class="like-btn" data-id="{{this._id}}">
      ğŸ‘ Like (<span class="likes-count">{{this.likes}}</span>)
    </button>
  </li>
  {{/each}}
</ul>
{{else}}
<p>No reviews yet</p>
{{/if}}

<!-- å¼•å…¥ç‚¹èµé€»è¾‘ -->
<script src="/js/reviews.js"></script>

<script>
  // ç”¨äºç‚¹èµæ›´æ–°çš„AJAXè¯·æ±‚
  function likeReview(reviewId) {
    fetch(`/reviews/${reviewId}/like`, {
      method: 'POST',
    })
    .then((response) => response.json())
    .then((data) => {
      if (data.success) {
        // æ›´æ–°ç‚¹èµæ•°
        document.getElementById(`likes-${reviewId}`).textContent = `Likes: ${data.likes}`;
      }
    });
  }

  // è¯·æ±‚æ–°çš„è¯„åˆ†æ•°æ®
  function updateRating() {
    fetch('/property/averageRating', { method: 'GET' })
      .then(response => response.json())
      .then(data => {
        // æ›´æ–°é¡µé¢ä¸Šçš„è¯„åˆ†æ•°æ®
        document.getElementById('averageRating').textContent = `Average Rating: ${data.averageRating}`;
      });
  }

  // é¡µé¢åŠ è½½æ—¶ï¼Œæ›´æ–°è¯„åˆ†
  window.onload = function () {
    updateRating();  // è·å–å¹¶æ›´æ–°è¯„åˆ†
  }
</script>