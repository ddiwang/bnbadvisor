{{!-- User Profile Page --}}
<div class="profile-container">
  <div class="profile-header">
    <div class="profile-info">
      <h1>{{user.firstName}} {{user.lastName}}</h1>
      <p class="profile-email">{{user.email}}</p>
      {{#if (eq user.role 'manager')}}
        <span class="badge badge-secondary">Host</span>
      {{else}}
        <span class="badge">Guest</span>
      {{/if}}
    </div>
  </div>

  {{#if success}}
    <div class="alert alert-success">
      <span class="alert-icon">✅</span>
      <span>{{success}}</span>
    </div>
  {{/if}}

  {{#if error}}
    <div class="alert alert-error">
      <span class="alert-icon">⚠️</span>
      <span>{{error}}</span>
    </div>
  {{/if}}

  {{#if isOwner}}
   
    <div class="profile-sections">
     
      <div class="profile-section">
        <h3>Personal Information</h3>
        <form method="POST" action="/users/profile">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName" class="form-label">First Name:</label>
              <input 
                type="text" 
                id="firstName" 
                name="firstName" 
                value="{{user.firstName}}" 
                required
                minlength="2"
                maxlength="25"
                class="form-control"
              >
            </div>
            
            <div class="form-group">
              <label for="lastName" class="form-label">Last Name:</label>
              <input 
                type="text" 
                id="lastName" 
                name="lastName" 
                value="{{user.lastName}}" 
                required
                minlength="2"
                maxlength="25"
                class="form-control"
              >
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary">Update Profile</button>
        </form>
      </div>

      <!-- Extension Area for Host Features -->
      {{#if (eq user.role 'manager')}}
        <!-- Host features can be added here by other team members -->
        <div id="host-features-extension"></div>
      {{/if}}

      <!-- Extension Area for Reviews/Ratings -->
      <div class="profile-section" id="reviews-extension">
        <h3>Reviews & Activity</h3>
        <!-- Placeholder for reviews system -->
        <div id="user-reviews-extension"></div>
      </div>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const userId = "{{user._id}}";
          fetch(`/reviews/user/${userId}`)
          .then(res => res.text()) // 注意是text！
          .then(html => {
        document.getElementById("user-reviews-extension").innerHTML = html;
        })
        .catch(() => {
      document.getElementById("user-reviews-extension").innerHTML = "加载评论失败";
       });
      });
      </script> 

      <!-- Logout -->
      <div class="profile-section">
        <h3>Account Actions</h3>
        <form method="POST" action="/users/logout">
          <button type="submit" class="btn btn-danger">Logout</button>
        </form>
      </div>
    </div>
  {{else}}
    <div class="profile-sections">
      <div class="profile-section">
        <h3>About {{user.firstName}}</h3>
        <p class="card-text">This is {{user.firstName}} {{user.lastName}}'s public profile.</p>
        <p class="card-text">Email: {{user.email}}</p>
      </div>
    </div>
  {{/if}}

  <div class="text-center mt-xl">
    <a href="/" class="btn btn-ghost">← Back to Home</a>
  </div>
</div>
